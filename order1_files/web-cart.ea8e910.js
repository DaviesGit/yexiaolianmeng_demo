webpackJsonp([100],{1350:function(t,e,n){t.exports=n(246)},246:function(t,e,n){!function(e,n){t.exports=n()}(0,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.Cart=e.Group=e.Entity=void 0;var r=i(n(1)),a=i(n(3)),u=i(n(4));e.Entity=r.default,e.Group=a.default,e.Cart=u.default,e.default=u.default},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),r=(function(t){t&&t.__esModule}(n(2)),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),(e.food_id||e.id)&&(this.id=e.food_id||e.id),e.sku_id&&(this.sku_id=e.sku_id),this.item_id=e.item_id,this.quantity=n,this.name=e.name,this.price=e.price,this.original_price=e.original_price,this.packing_fee=e.packing_fee,this.stock=e.stock||0,this.specs=e.new_specs||e.specs||[],this.attrs=e.attrs||[],e.hasOwnProperty("weight")&&(this.weight=e.weight),e.activity&&(this.activity=e.activity),this.extra=i||{},e.ingredients&&(this.ingredients=e.ingredients.map(function(e){return new t(e)}))}return i(t,[{key:"set",value:function(t){var e=parseInt(t,10);return e||0===e?(this.quantity=e<0?1:e,{quantity:this.quantity,action:""}):this.quantity}},{key:"updateData",value:function(t,e){var n=t.name,i=t.original_price,r=t.price,a=t.stock,u=t.packing_fee,s=t.new_specs,o=t.specs,c={name:n,original_price:i,price:r,stock:a,packing_fee:u,weight:t.weight,attrs:t.attrs,extra:e,specs:s||o};for(var f in c){var d=c[f];this[f]=void 0===d?this[f]:d}return this}}]),t}());e.default=r},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return+t.toFixed(2)}},function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{default:t}}function r(t,e){return t.length===e.length&&e.every(function(e){return t.some(function(t){return t.name===e.name&&t.value===e.value})})}function a(t,e){return t.length===e.length&&e.every(function(e){return t.some(function(t){return t.sku_id===e.sku_id})})}Object.defineProperty(e,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),s=i(n(1)),o=(i(n(2)),function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments[1];(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),Array.isArray(e)?this.entities=e.map(function(t){return new s.default(t,t.quantity,t.extra)}):(this.packages=(e.packages||[]).map(function(t){return{package_id:t.package_id,quantity:t.quantity,entities:(t.sub_items||t.entities).map(function(t){return new s.default(t,t.quantity)}),stock:t.stock}}),this.entities=(e.entities||[]).map(function(t){return new s.default(t,t.quantity,t.extra)})),this.maxDiscountQuantity=n}return u(t,[{key:"findById",value:function(t){return this.entities.filter(function(e){var n=t.sku_id?"sku_id":"id";return t[n]===e[n]})}},{key:"find",value:function(t){var e=this.findById(t);return t.attrs&&Array.isArray(t.attrs)?(e=e.filter(function(e){return r(e.attrs,t.attrs)}),t.ingredients&&(e=e.filter(function(e){return a(e.ingredients||[],t.ingredients)})),e[0]):e[0]}},{key:"findPackage",value:function(t){var e=void 0;return this.packages?(this.packages.some(function(n){return n.package_id===t.package_id&&((t.entities||t.sub_items).every(function(t){return n.entities.some(function(e){return e.sku_id===t.sku_id&&r(e.attrs,t.attrs)&&a(e.ingredients||[],t.ingredients||[])})})?(e=n,!0):void 0)}),e):e}},{key:"getQuantityById",value:function(t){return this.findById(t).reduce(function(t,e){return t+e.quantity},0)}},{key:"getQuantityByIdAndAttrs",value:function(t){return this.find(t).quantity}},{key:"set",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.find(t);i?i.updateData(t,n):(i=new s.default(t,0,n),this.entities.push(i));var r=i.quantity,a=i.set(e).quantity;if(a<=0)return this.entities.splice(this.entities.indexOf(i),1),{entity:i,action:"ENTITY_DESTROY"};return{entity:i,action:0===r?"ENTITY_CREATE":a>r?"ENTITY_ADD":"ENTITY_SUB"}}}]),t}());e.default=o},function(t,e,n){"use strict";function i(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),a=function(t){return t&&t.__esModule?t:{default:t}}(n(3)),u="CART_MAP",s=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=JSON.stringify(t);return"undefined"!=typeof localStorage?localStorage.setItem(u,e):"undefined"!=typeof wx?wx.setStorageSync(u,e):{}},o=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")})(this,t),this.restaurant_id=e,this.cartMap={},this.groups=[],this.quantity=0,this.total=0,this.maxDiscountQuantity=n,this.load(),this.count(!0)}return r(t,[{key:"loadCartMap",value:function(){var t="undefined"!=typeof localStorage?window.UParams().cart_map||localStorage.getItem(u):"undefined"!=typeof wx?wx.getStorageSync(u):{};if(t)try{this.cartMap=JSON.parse(t)}catch(t){console.error("CANNOT PARSE CART_MAP FROM LOCALSTORAGE.")}else this.update([new a.default])}},{key:"load",value:function(){var t=this;this.loadCartMap(),this.cartMap[this.restaurant_id]||this.update([new a.default([],this.maxDiscountQuantity)]),this.groups=this.cartMap[this.restaurant_id].map(function(e){var n=e.entities;return e.packages&&(n={entities:e.entities,packages:e.packages}),new a.default(n,t.maxDiscountQuantity)})}},{key:"update",value:function(t){this.groups=t,this.cartMap[this.restaurant_id]=t,s(this.cartMap),this.count()}},{key:"updateFromCartData",value:function(t){var e=t.map(function(t){return new a.default(t)});return this.loadCartMap(),this.update(e),this.groups}},{key:"count",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=0;return(t=[]).concat.apply(t,i(this.groups.map(function(t){return t.entities}))).forEach(function(t){n+=t.quantity}),this.groups.forEach(function(t){t.packages&&t.packages.forEach(function(t){n+=t.quantity})}),this.quantity=n,e||this.setQuantityInStorage(),{quantity:n}}},{key:"createGroup",value:function(){var t=new a.default([],this.maxDiscountQuantity);return this.loadCartMap(),this.update([].concat(i(this.groups),[t])),{group:t,action:"GROUP_CREATE"}}},{key:"removeGroup",value:function(t){var e=this.groups[t],n=this.groups.filter(function(e,n){return n!==t});return this.loadCartMap(),this.update(n),{group:e,action:"GROUP_DESTROY"}}},{key:"clearGroup",value:function(t){var e=this.groups[t]=new a.default;return this.loadCartMap(),this.update(this.groups),{group:e,action:"GROUP_CLEAR"}}},{key:"clearCart",value:function(){return this.groups=[],{group:this.createGroup().group,action:"CART_CLEAR"}}},{key:"setEntity",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=(this.groups[n]||this.clearCart().group).set(t,e,i),a=r.entity,u=r.action,s=r.activityAction;return this.loadCartMap(),this.update(this.groups),{entity:a,action:u,activityAction:s}}},{key:"setQuantityInStorage",value:function(){var t=this,e=void 0;try{e=JSON.parse(localStorage.getItem("STORE"))||{}}catch(t){e={}}var n=e.CARTS_QUANTITY||[];if(n.length&&(n=n.filter(function(e){return e.restaurant_id!==t.restaurant_id})),this.quantity){if(10===n.length){var i=n.pop();this.cartMap[i.restaurant_id]&&delete this.cartMap[i.restaurant_id]}n.unshift({restaurant_id:this.restaurant_id,quantity:this.quantity})}e.CARTS_QUANTITY=n,s(this.cartMap),localStorage.setItem("STORE",JSON.stringify(e))}}]),t}();e.default=o}])})}},[1350]);
//# sourceMappingURL=https://pages.elenet.me/perf-sentry-sourcemaps/h5/1571319801832/web-cart.ea8e910.js.map