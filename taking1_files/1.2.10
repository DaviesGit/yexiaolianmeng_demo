var Geohash=new function(){var round=Math.round;var max=Math.max;var pow=Math.pow;var log=Math.log;var table="0123456789bcdefghjkmnpqrstuvwxyz";var isGeohash=new RegExp("^["+table+"]+$");var Rect=function(){};Rect.prototype={minlat:-90,maxlat:90,minlng:-180,maxlng:180,halfLat:function(){return(this.minlat+this.maxlat)/2},halfLng:function(){return(this.minlng+this.maxlng)/2}};this.encode=function(lat,lng){if(lat instanceof Array&&lng==null){lng=lat[1];lat=lat[0]}lat*=1;lng*=1;if(lat!==lat)throw new Error("Geohash.encode: lat must be a Number");if(lng!==lng)throw new Error("Geohash.encode: lng must be a Number");var lap=lat.toString().length-lat.toFixed().length-2;var lop=lng.toString().length-lat.toFixed().length-2;var prec=pow(10,-max(lap,lop,0))/2;var rect=new Rect;var result=[];var edge=180;var even=true;var chr=0;var bit=4;var next;var last;while(edge>=prec){if(even){next=rect.halfLng();if(lng>next){chr|=1<<bit;rect.minlng=next}else{rect.maxlng=next}}else{next=rect.halfLat();if(lat>next){chr|=1<<bit;rect.minlat=next}else{rect.maxlat=next}}even=!even;if(bit){bit--}else{last=edge;edge=max(rect.maxlng-rect.minlng,rect.maxlat-rect.minlat);if(last===edge)break;result.push(table[chr]);bit=4;chr=0}}return result.join("")};this.decode=function(hash){if(!isGeohash.test(hash))throw new Error("Geohash.decode: hash must be a geohash string");var rect=new Rect;var latE=90;var lngE=180;var shink=function(bit,value,even){var bin=1<<bit;if(!(bit&1)^!(even&1)){if(bin&value){rect.minlat=rect.halfLat()}else{rect.maxlat=rect.halfLat()}}else{if(bin&value){rect.minlng=rect.halfLng()}else{rect.maxlng=rect.halfLng()}}};for(var i=0,c=hash.length;i<c;i++){var value=table.indexOf(hash[i]);var even=i&1;for(var bit=4;bit>=0;bit--)shink(bit,value,even);if(even){latE/=8;lngE/=4}else{latE/=4;lngE/=8}}var pLat=pow(10,max(1,-round(log(latE)/log(10)))-1);var pLng=pow(10,max(1,-round(log(lngE)/log(10)))-1);return[round(rect.halfLat()*pLat)/pLat,round(rect.halfLng()*pLng)/pLng]}};if(typeof module==="object")module.exports=Geohash;
!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("geohash.js")):"function"==typeof define&&define.amd?define(["geohash.js"],n):e.ebridge=n(e.Geohash)}(this,function(u){"use strict";function i(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function n(n,e){var t=Object.keys(n);return Object.getOwnPropertySymbols&&t.push.apply(t,Object.getOwnPropertySymbols(n)),e&&(t=t.filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})),t}function s(o){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(r,!0).forEach(function(e){var n,t,i;n=o,i=r[t=e],t in n?Object.defineProperty(n,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[t]=i}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(r)):n(r).forEach(function(e){Object.defineProperty(o,e,Object.getOwnPropertyDescriptor(r,e))})}return o}function d(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],i=!0,o=!1,r=void 0;try{for(var a,c=e[Symbol.iterator]();!(i=(a=c.next()).done)&&(t.push(a.value),!n||t.length!==n);i=!0);}catch(e){o=!0,r=e}finally{try{i||null==c.return||c.return()}finally{if(o)throw r}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function o(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}u=u&&u.hasOwnProperty("default")?u.default:u;var e=window.navigator.userAgent,t=window.location,r=t.protocol,a=t.origin,c=/iPhone|iPad|iPod/i.test(e),l=(/Android/i.test(e),"@ele_geohash");function f(n,t){Object.keys(t).forEach(function(e){n[e]=t[e]})}function w(e){var n=e;return/^\/\//.test(e)?n=r+e:/^\w+:\/\//.test(e)||(n="".concat(a).concat("/"===e[0]?"":"/").concat(e)),n}function h(i){return Object.keys(i).reduce(function(e,n){var t=i[n];return void 0!==t&&e.push("".concat(encodeURIComponent(n),"=").concat(encodeURIComponent(t))),e},[]).join("&")}function g(e){var i={};return e.replace(/([^#&?=]*)=([^#&?]*)/g,function(e,n,t){i[decodeURIComponent(n)]=decodeURIComponent(t)}),i}function p(e,n){var t=new Error(1<arguments.length&&void 0!==n?n:"");return t.name=e||"ERROR",t}function v(e,n){var t=h(n);return t?"".concat(e).concat(/[?#]/.test(e)?"&":"?").concat(t):e}function m(e){return window.my&&window.my[e]}function y(e,n){var t=g(e);return Object.keys(t).filter(function(e){return n.test(e)})}function A(){var e=g(window.location.href),n=e.geohash,t=e.longitude||e.lng,i=e.latitude||e.lat;if(!n&&t&&i&&(n=u.encode(i,t)),n=n||window.sessionStorage.getItem(l))try{var o=d(u.decode(n),2),r=o[0],a=o[1];return window.sessionStorage.setItem(l,n),{latitude:r,longitude:a}}catch(e){}return null}var b={NO_HANDLER:"NO_HANDLER",TIMEOUT:"TIMEOUT",USER_DENIED:"USER_DENIED",UNKNOWN_ERROR:"UNKNOWN_ERROR"},P="h5.ele.me",I={1:b.USER_DENIED,3:b.TIMEOUT};function E(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(n.checkQuery){var e=A();if(e)return Promise.resolve(e)}return/Youku\/([0-9.]+)/.test(window.navigator.userAgent)?Promise.reject(p(b.NO_HANDLER)):new Promise(function(r,a){var e=1e3*(n.timeout||10),c=setTimeout(function(){a(p(b.TIMEOUT,"获取定位超时"))},100+e);window.navigator.geolocation.getCurrentPosition(function(e){clearTimeout(c);var n=e.coords;if(!n.latitude)return a(p(b.USER_DENIED));var t=n.latitude,i=n.longitude;if(window.Geohash){var o=window.Geohash.encode(t,i);window.sessionStorage.setItem("ele_geohash",o)}return r({latitude:t,longitude:i})},function(e){clearTimeout(c),a(p(I[e&&e.code],e.message))},{timeout:e,maximumAge:1e3*(n.cacheTimeout||1800)})})}function L(e){var i=0<arguments.length&&void 0!==e?e:{};return function(t){return new Promise(function(e,n){window.lib.windvane.call("WVFile","read",t,e,n)})}({fileName:"takeout-location.txt",share:"true"}).then(function(e){var n=JSON.parse(e.data),t=1e3*(i.cacheTimeout||1800);return n&&n.expirationTime&&!function(e,n){return n<new Date-new Date(+e)}(n.expirationTime,t)?{latitude:n.latitude,longitude:n.longitude}:Promise.reject()})}function T(e){var n=0<arguments.length&&void 0!==e?e:{};if(n.checkQuery){var t=A();if(t)return Promise.resolve(t)}return new Promise(function(t,e){window.WindVane.call("WVLocation","getLocation",{enableHighAcuracy:!0},function(e){var n=e.coords;t({latitude:n.latitude,longitude:n.longitude})},function(){E(n).then(t,e)},1e3*(n.timeout||10))})}var M=function(e){return window.document.querySelector('meta[name="'.concat(e,'"]'))};function S(){var e=g(window.location.href).spm||"",n="",t=M("spm-id");if(t){var i=t.getAttribute("content");/^\w+\.\w+$/.test(i)&&(n="".concat(i,".0.0"))}else{var o=M("data-spm"),r=o&&o.getAttribute("content"),a=window.document.body.getAttribute("data-spm");r&&a&&(n="".concat(r,".").concat(a,".0.0"))}var c={};return e&&(c["spm-pre"]=e),n&&(c.spm=n),c}function _(){var e=[],n=window.location.href,t=function(e){var n=document.querySelector("meta[name=".concat(e,"]"));return n?n.getAttribute("content"):null}("sendlog-params-prefix");return t&&(e=y(n,new RegExp("^".concat(t)))),e=[].concat(o(e),o(y(n,new RegExp("^".concat("kb_")))))}function W(){return["from","opensite_extra"].concat(o(_()))}var N=function(){var n={},t=g(window.location.href);return W().forEach(function(e){void 0!==t[e]&&(n[e]=t[e])}),n},O=W();function D(e,n,t){var i=1<arguments.length&&void 0!==n?n:{},o=!(2<arguments.length&&void 0!==t)||t,r=S(),a=g(window.location.href);/[#&?]spm=/.test(e)&&delete r.spm;var c=s({},r,{},i),u=window.sessionStorage.getItem(l);return/[#&?]geohash=/.test(e)||c.geohash||!u||(c.geohash=u),Object.keys(a).forEach(function(e){~O.indexOf(e)&&(c[e]=a[e])}),v(o?w(e):e,c)}function R(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(/^taobao:\/\//.test(e))window.location.href=e;else if(/wml_path/.test(e))!function(e,n){var t=g(e),i=document.createElement("a");i.href=e,t.wml_path&&(t.wml_path=D(t.wml_path,n.query||{},!1)),t._wml_path&&(t._wml_path=D(t._wml_path,n.query||{},!1)),e="".concat(i.origin,"?").concat(h(t)),window.WindVane.call("WVNative","openWindow",{url:e},function(){},function(){window.location.href=e})}(e,n);else{var t=D(e,n.query||{});n.oldWebview?window.location.href=t:window.WindVane.call("WVNative","openWindow",{url:t},function(){},function(){window.location.href=t})}}var x="WV.Event.APP.Active",k=[];function C(e){var n=e&&e.param&&e.param.from;if("background"!==n){var t="webview"===n;k.forEach(function(e){e({strict:t})})}}function B(e){k.length||window.document.addEventListener(x,C,!1),-1===k.indexOf(e)&&k.push(e)}function U(e){var n=k.indexOf(e);-1!==n&&k.splice(n,1),k.length||window.document.removeEventListener(x,C,!1)}var j={weixin:"wxfriend",weixin_timeline:"wxfriend",weibo:c?"sinaweibo":"weibo",dingtalk:"dingtalk",qq:"qq",alipay:"alipay",contacts:"contacts",copy:"copy",guangjie:"guangjie",momo:"momo",present:"present",qrcode:"qrcode",wangxin:"wangxin"};function q(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=(t.bizId||{}).taobao;if(!i)throw new Error("缺少淘宝 businessId");var o=(t.targets||[]).reduce(function(e,n){var t=j[n];return t&&-1===e.indexOf(t)?e.concat(t):e},[]);if(!o.length)throw new Error("targets 校验失败");return new Promise(function(e,n){window.WindVane.call("TBSharedModule","showSharedMenu",{title:t.title,url:t.url,text:t.content,image:t.image,businessId:i,targets:o},e,n)})}function V(){setTimeout(function(){q(Q.options),"function"==typeof Q.clickCb&&Q.clickCb()},100)}var Q={};function J(e){if(!e.eId)throw new Error("eId is not found");var n=s({},e.extra||{},{id:e.eId,food_id:e.eItemId,spm:e.spm});if(e.scheme){var t=g(e.scheme);if(t.cart_operations)try{var i=JSON.parse(t.cart_operations).add_foods;i&&i.length&&(n.cartOperations=JSON.stringify({add_foods:i.map(function(e){return{id:e.id,sku_id:e.sku_id}})}))}catch(e){}}return"//".concat(P,"/shop/#").concat(h(n))}function H(){}var F={getLocation:E,openWindow:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};window.location.href=D(e,n.query||{})},getDeviceId:function(){return Promise.resolve("")},goLogin:function(e){var n=(0<arguments.length&&void 0!==e?e:{}).redirect||window.location.href;window.location.href="//".concat(P,"/login/#redirect=").concat(encodeURIComponent(n))},isAppInstall:function(){return Promise.reject(p(b.NO_HANDLER))},openShop:function(e){var n=0<arguments.length&&void 0!==e?e:{};window.location.href=J(n)},showToast:function(e){var n=0<arguments.length&&void 0!==e?e:{};window.alert(n.message)},onPageResume:H,offPageResume:H,share:function(){return Promise.reject(p(b.NO_HANDLER))},setShare:function(){return Promise.reject(p(b.NO_HANDLER))},popWindow:function(){window.history.back()}},K={};f(K,s({},F,{getLocation:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return e.useTaoCache?L(e).catch(function(){return T(e)}):T(e)},getDeviceId:function(){return new Promise(function(n){window.WindVane.call("TBDeviceInfo","getUtdid",{},function(e){n(e.utdid)},function(){n("")})})},openWindow:R,goLogin:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return n.redirect?window.lib.login.goLogin(n.redirect):window.lib.login.goLoginAsync().then(function(){n.success&&n.success()}).catch(function(e){n.fail&&n.fail(e)})},isAppInstall:function(n){return new Promise(function(e){window.WindVane.call("Base","isInstall",n,function(){e(!0)},function(){e(!1)})})},openShop:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!e.tbId)throw new Error("tbId is not found");var n=s({},e.extra||{},{shopId:e.tbId,anchorItemId:e.tbItemId,spm:e.spm});R("//h5.m.taobao.com/app/waimai/shop.html?".concat(h(n)))},showToast:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};window.WindVane.call("WVUIToast","toast",{message:e.message,duration:e.duration||2})},onPageResume:B,offPageResume:U,share:q,popWindow:function(){window.WindVane.call("WVNative","nativeBack")},setShare:function(e,n){Q.options=e,Q.clickCb=n,document.removeEventListener("TBNaviBar.moreItem.clicked",V,!1),document.addEventListener("TBNaviBar.moreItem.clicked",V,!1);window.WindVane&&window.WindVane.call("WebAppInterface","setNaviBarMoreItem",{items:[{icon:"share",fromNative:"true",iconFont:"true",text:"分享"}],autoReset:!0},function(){},function(){})}}));var z={weixin:{value:0},weixin_timeline:{value:1},weibo:{value:2},qq:{value:4},qzone:{value:5},dingtalk:{value:8}};function G(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.targets||[];if(!n.length)throw new Error("targets 校验失败");var t="image"===e.contentType?1:0;return 1===n.length?window.location.href="eleme://share?".concat(h({type:z[n[0]].value,title:e.title,text:e.content,url:e.url,image_url:encodeURI(decodeURI(e.image)),image_only:t})):window.hybridAPI.sharePanel({targets:n.filter(function(e){return!!z[e]}),title:e.title,text:e.content,url:e.url,image_url:e.image,source:(e.bizId||{}).eleme||"",image_only:t}),Promise.resolve()}var Y={getLocation:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise(function(r,a){if(window.hybridAPI.compareVersion("7.26"))window.hybridAPI.getGlobalGeohash().then(function(e){if(e){var n=d(u.decode(e),2),t=n[0],i=n[1];/^-180/.test(t)?a(p(b.USER_DENIED)):r({latitude:t,longitude:i})}else a(p(b.USER_DENIED))});else{var c=!1!==e.useTaoCache;window.hybridAPI.getSyncLocation().then(function(e){var n=e.lat,t=e.lng,i=e.locLat,o=e.locLng;c&&!/^-180/.test(n)?r({latitude:n,longitude:t}):/^-180/.test(i)?a(p(b.USER_DENIED)):r({latitude:i,longitude:o})})}setTimeout(function(){a(p(b.TIMEOUT))},1e3*(e.timeout||10))})},getDeviceId:function(){return window.hybridAPI.getCuid()},openWindow:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(/^eleme:\/\//.test(e))window.location.href=e;else{var t=s({},n.elemeParams||{},{url:D(e,n.query||{})});t.animation_type=t.animation,delete t.animation,n.oldWebview?window.location.href=t.url:window.location.href="eleme://web?".concat(h(t))}},goLogin:function(){window.location.href="eleme://login"},isAppInstall:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(c)return 0<window.hybridAPI.compareVersion("8.3.0")?Promise.reject(p(b.NO_HANDLER)):window.hybridAPI.checkAppInstall(e.ios);var n=e.android;return window.hybridAPI.checkPackages([n]).then(function(e){return e[n]})},openShop:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!e.scheme)throw new Error("scheme is not found");window.location.href=e.scheme},showToast:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};window.hybridAPI.toast({text:e.message,duration:1e3*(e.duration||2)})},onPageResume:B,offPageResume:U,share:G,popWindow:function(){window.hybridAPI.closePage()},setShare:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0,t=(window.hybridAPI||{}).setRightMenu;t&&t([{text:e.shareText||"分享",iconHash:e.shareIcon||"https://fuss10.elemecdn.com/0/6e/b1b68e054bc6337952d477810fe43png.png",eventName:e.shareEventName||"shareStage",action:function(){G(e),"function"==typeof n&&n()},overflow:!1}])},pay:function(t){return window.hybridAPI.compareVersion("7.17")?window.location.href=t:new Promise(function(e,n){window.hybridAPI.pay({merchantId:(t.match(/merchantId=(\d+)/)||[])[1],merchantOrderNo:(t.match(/merchantOrderNo=(\d+)/)||[])[1],xShard:decodeURIComponent((t.match(/xShard=(.+)&?/)||[])[1])}).then(e).catch(function(e){"NOT_SUPPORT"!==e.name?n(e):window.location.href=t})})}},X=function(){function n(e){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),this.apiFunc=e,this.queue=[]}return function(e,n,t){n&&i(e.prototype,n),t&&i(e,t)}(n,[{key:"run",value:function(){for(var t=this,e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return new Promise(function(e,n){t.queue.push([e,n]),1===t.queue.length&&t.apiFunc.apply(t,i).then(function(n){t.queue.forEach(function(e){return(0,d(e,1)[0])(n)}),t.queue=[]}).catch(function(n){t.queue.forEach(function(e){return(0,d(e,2)[1])(n)}),t.queue=[]})})}}]),n}(),Z={11:b.USER_DENIED,14:b.TIMEOUT},$={12:b.USER_DENIED},ee=new X(function(e){var n=window.ap.compareVersion("10.0.18")<0,t=e.timeout||10,i=e.cacheTimeout||1800;return(n?window.ap.getLocation({timeout:t,cacheTimeout:i}):window.ap.call("getCurrentLocation",{timeout:t,cacheTimeout:i,requestType:0,bizType:"".concat(c?"iOS":"Android","-ele-position")})).then(function(e){return{latitude:e.latitude,longitude:e.longitude}}).catch(function(e){throw p((n?$:Z)[e.error],e.errorMessage||"定位失败")})});function ne(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(/^alipays:\/\//.test(e))window.location.href=e;else if(window.AlipayJSBridge){var t,i=S();/[#&?]spm=/.test(e)&&delete i.spm,/[#&?]geohash=/.test(e)||(t=window.sessionStorage.getItem(l));var o=w(e);n.oldWebview?window.location.href=o:window.ap.pushWindow({url:o,params:n.launchParams||{},data:s({},i,{},t?{geohash:t}:{},{},N(),{},n.query||{})})}else window.location.href=D(e,n.query||{})}var te=[];function ie(){te.forEach(function(e){e({strict:!0})})}var oe={weixin:"Weixin",weixin_timeline:"WeixinTimeLine",weibo:"Weibo",dingtalk:"DingTalkSession",qq:"QQ"},re=["SMS","QQZone","OpenInSafari","Favorite","ALPContact","ALPTimeLine","ALPCommunity"];function ae(e,n){var i=1<arguments.length&&void 0!==n?n:{};return new Promise(function(n,t){window.AlipayJSBridge.call("shareToChannel",{name:e,param:{title:i.title,content:i.content,url:i.url,imageUrl:i.image,otherParams:i.otherParams||{},contentType:i.contentType||"url"}},function(e){e.shareResult?n():t()})})}function ce(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],i=(n.targets||[]).reduce(function(e,n){return oe[n]?e.concat(oe[n]):e},[]);if(!i.length)throw new Error("targets 校验失败");return 1===i.length?ae(i[0],n):new Promise(function(e){t?window.AlipayJSBridge.call("setToolbarMenu",{menus:[],override:!0}):window.AlipayJSBridge.call("setToolbarMenu",{reset:!0}),window.AlipayJSBridge.call("startShare",{bizType:(n.bizId||{}).alipay||"template_normal",onlySelectChannel:t?i:i.concat(re)},e)}).then(function(e){return ae(e.channelName,n)})}var ue={getLocation:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(e.checkQuery){var n=A();if(n)return Promise.resolve(n)}return ee.run(e)},getDeviceId:function(){return new Promise(function(i){window.ap.call("getConfig",{configKeys:["did"]},function(e){var n=e.data,t=void 0===n?{}:n;i(e.did||t.did||"")})})},openWindow:ne,goLogin:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).redirect||window.location.href;window.location.href="//".concat(P,"/login/#redirect=").concat(encodeURIComponent(e))},isAppInstall:function(e){var t={scheme:e.ios,packageName:e.android};return new Promise(function(n){window.ap.isInstalledApp?window.ap.isInstalledApp(t,function(e){n(e.isInstalled)}):window.AlipayJSBridge.call("isInstalledApp",t,function(e){n(e.installed)})})},openShop:function(){ne(J(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}))},showToast:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};window.ap.showToast({content:e.message,duration:1e3*(e.duration||2)})},onPageResume:function(e){te.length||window.ap.onPageResume(ie),-1===te.indexOf(e)&&te.push(e)},offPageResume:function(e){var n=te.indexOf(e);-1!==n&&te.splice(n,1),te.length||window.ap.offPageResume(ie)},share:ce,popWindow:function(){window.ap.popWindow()},setShare:function(e,n){window.ap.setOptionButton({onClick:function(){ce(e,!1),"function"==typeof n&&n()},reset:!1,preventDefault:!0})},pay:function(i){return new Promise(function(n,t){var e=JSON.parse(i||null).payData.ALI_PAY||JSON.parse(i||null).payData.HUABEI_PAY;window.ap.tradePay({orderStr:e},function(e){"9000"===e.resultCode?n():t(new Error({message:"支付失败"}))})})}};var se=new X(function(t){return new Promise(function(i,n){window.sns.getLocation().then(function(e){var n=e.latitude,t=e.longitude;i({latitude:n,longitude:t})}).catch(function(e){e&&/cancel$/.test(e.errMsg)?n(p(b.USER_DENIED)):E(t).then(i,n)})})});var de={};function le(e){var n=0<arguments.length&&void 0!==e?e:{};return new Promise(function(i,e){window.my.getLocation(s({success:function(e){var n=e.longitude,t=e.latitude;i({longitude:n,latitude:t})},fail:function(){E(n).then(i,e)}},n))})}f(de,F),f(de,{setShare:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};window.sns&&window.sns.share({title:e.title,link:e.url,desc:e.content,imgUrl:e.image},function(){},function(){})}}),f(de,{getLocation:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(e.checkQuery){var n=A();if(n)return Promise.resolve(n)}return window.sns?se.run(e):E(e)}});var fe=/^(http:|https:)?\/\//,we=/_ariver_appid|_wml_code/i,he=/AliApp\((AP|KB).+MiniProgram/i.test(window.navigator.userAgent);function ge(e,n){var t="https://gm.mmstat.com/eleme-h5.openWindow.".concat(e,"?t=").concat(Date.now(),"&open_url=").concat(encodeURIComponent(n));window.navigator&&window.navigator.sendBeacon?navigator.sendBeacon(t):(new Image).src=t}function pe(e){ge("default",e),window.location.href=e}function ve(n,t){var e=t?"".concat(n).concat(encodeURIComponent(t)):n;try{window.my.navigateTo({url:e})}catch(e){pe(t||n)}}var me={};f(me,F),f(me,{getLocation:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(e.checkQuery){var n=A();if(n)return Promise.resolve(n)}return!1!==e.useTaoCache?/MiniProgram|Triver/i.test(navigator.userAgent)?function(c){return m("postMessage")?new Promise(function(o,r){var a=setTimeout(function(){le(c).then(o,r)},3e3);window.my.onMessage=function(e){if(e&&"getStorage"===e.action){clearTimeout(a);try{var n=e.data.location,t=n.latitude,i=n.longitude;t&&i?o({latitude:t,longitude:i}):le(c).then(o,r)}catch(e){le(c).then(o,r)}}},window.my.postMessage({action:"getStorage",key:"ElemeMiniApp"})}):le(c)}(e):function(a){return m("getStorage")?new Promise(function(o,r){window.my.getStorage({key:"ELEME_ElemeMiniApp",success:function(e){try{var n=JSON.parse(e.data).data.location,t=n.latitude,i=n.longitude;t&&i?o({latitude:t,longitude:i}):le(a).then(o,r)}catch(e){le(a).then(o,r)}},fail:function(){le(a).then(o,r)}})}):le(a)}(e):le(e)},goLogin:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};m("postMessage")&&window.my.postMessage(s({action:"trustLogin"},e))},openWindow:function(e){var n=D(e,(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).query||{},!1),t=g(n);if(ge("pv",n),/postmessage:\/\//.test(n)){if(!m("postMessage"))return void ge("js-error",n);var i=d(n.match(/postmessage:\/\/(\S+)/)[1].split("?"),1)[0];window.my.postMessage({action:i,data:t})}else{if(!m("navigateTo"))return ge("js-error",n),void pe(n);if(fe.test(n)&&!we.test(n)){var o=t.newWindow,r=t.hideNavbar,a=t.outsideWeb;if(("1"===a||"true"===a)&&!he)return void(/Triver/i.test(navigator.userAgent)?window.my.call("navigateToOutside",{url:n}):ve(n));if("1"===o||"true"===o)return"1"===r||"true"===r?void ve("/pages/webview-redirect-transnavbar/webview-redirect?url=",n):void ve("/pages/webview-redirect/webview-redirect?url=",n);pe(n)}else if(/Triver/i.test(navigator.userAgent)&&fe.test(n)){var c=t.page;if(/_outer_jump/.test(n)||!c)return void window.my.call("navigateToOutside",{url:n});c=/^\//.test(c)?c:"/".concat(c),delete t._wml_code,delete t._wml_path,delete t._ariver_appid,delete t.page,delete t._outer_jump,ve(v(c,t))}else/^[a-z]+:\/\//i.test(n)&&!/^https?:\/\//.test(n)?window.location.href=n:ve(n)}},popWindow:function(){m("navigateBack")&&window.my.navigateBack()},pay:function(e){return new Promise(function(n,t){window.my.tradePay({orderStr:e,success:function(e){"9000"===e.resultCode?n():t(new Error({message:"支付失败"}))},fail:t})})},getDeviceId:function(){return new Promise(function(n){if(m("postMessage")){var t=setTimeout(function(){n("")},2e3);window.my.onMessage=function(e){e&&"getDeviceId"===e.action&&(clearTimeout(t),n((e.data||{}).deviceId||""))},window.my.postMessage({action:"getDeviceId"})}else n("")})}});var ye=new Promise(function(e){window.WMApp?e():document.addEventListener("WMAppReady",e)});function Ae(){this.MCBAND=[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],this.LLBAND=[75,60,45,30,15,0],this.MC2LL=[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],this.LL2MC=[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]]}Ae.prototype.getRange=function(e,n,t){return void 0!==n&&(e=n<e?e:n),void 0!==t&&(e=t<e?t:e),e},Ae.prototype.getLoop=function(e,n,t){for(;t<e;)e-=t-n;for(;e<n;)e+=t-n;return e},Ae.prototype.convertor=function(e,n){if(e&&n){var t=n[0]+n[1]*Math.abs(e[0]),i=Math.abs(e[1])/n[9],o=n[2]+n[3]*i+n[4]*i*i+n[5]*i*i*i+n[6]*i*i*i*i+n[7]*i*i*i*i*i+n[8]*i*i*i*i*i*i;return[t*=e[0]<0?-1:1,o*=e[1]<0?-1:1]}},Ae.prototype.convertLL2MC=function(e){var n;e[0]=this.getLoop(e[0],-180,180),e[1]=this.getRange(e[1],-74,74);for(var t=e,i=this.LLBAND.length,o=0;o<i;o++)if(t[1]>=this.LLBAND[o]){n=this.LL2MC[o];break}if(!n)for(var r=i-1;0<=r;r--)if(t[1]<=-this.LLBAND[r]){n=this.LL2MC[r];break}var a=this.convertor(e,n);return{longitude:a[0].toFixed(4),latitude:a[1].toFixed(4)}},Ae.prototype.convertMC2LL=function(e){for(var n,t=[Math.abs(e[0]),Math.abs(e[1])],i=this.MCBAND.length,o=0;o<i;o++)if(t[1]>=this.MCBAND[o]){n=this.MC2LL[o];break}var r=this.convertor(e,n);return{longitude:r[0].toFixed(6),latitude:r[1].toFixed(6)}};var be=new Ae;function Pe(e){return be.convertMC2LL(e)}var Ie=new X(function(){return new Promise(function(c,u){window.WMApp.location.getAsyncLocation(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.lng,t=e.lat,i=e.eLng,o=e.eLat,r=e.eLocLat,a=e.eLocLng;n||t||i||o||u(p(b.USER_DENIED)),c({lng:n,lat:t,eLng:i,eLat:o,eLocLat:r,eLocLng:a})})})});var Ee={weixin:"WXSessionShare",weixin_timeline:"WXTimelineShare",weibo:"WeiboShare",qq:"QQSessionShare",qzone:"QQZoneShare"},Le={url:0,image:1};function Te(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.targets||[];if(!n.length)throw new Error("targets 校验失败");var t={},i={imageUrl:e.image,title:e.title,description:e.content,linkUrl:e.url,bigImageUrl:e.image,shareType:Le[e.contentType]||0};n.forEach(function(e){t[Ee[e]]=i});try{return!function(e,n){var o,t=e,r=n;if(!r){var i=d((window.navigator.userAgent.match(/(Eleme|wmapp)\/([\d|.]+)/i)||[])[2],3)[2];if(!(r=i))return!1}return t=t.split("."),r=r.split("."),t.forEach(function(e,n){var t=r[n];if(void 0===t&&(t=0),void 0===o){var i=Number(e)-Number(t);0!=i&&(o=0<i)}}),!!o}("3.9.1")?window.WMApp.share.universalShare(t):window.WMApp.share.share(i),Promise.resolve()}catch(e){return Promise.reject()}}var Me={};f(Me,F),f(Me,{getLocation:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return ye.then(function(){return function(){var u=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(u.checkQuery){var e=A();if(e)return Promise.resolve(e)}return Ie.run(u).then(function(e){var n=e.lng,t=e.lat,i=e.eLng,o=e.eLat,r=e.eLocLat,a=e.eLocLng,c=!1!==u.useTaoCache;return c&&i&&o?{longitude:Number(i),latitude:Number(o)}:c&&n&&t?Pe([n,t]):a&&r?{longitude:Number(a),latitude:Number(r)}:n&&t?Pe([n,t]):Promise.reject()})}.apply(void 0,n)})},getDeviceId:function(){for(var e=arguments.length,n=new Array(e),t=0;t<e;t++)n[t]=arguments[t];return ye.then(function(){return function(){return new Promise(function(e,n){try{e(window.WMApp.device.getCuid())}catch(e){n()}})}.apply(void 0,n)})},openWindow:function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(/^bdwm:\/\//.test(e))window.location.href=e;else{var t=s({},n.starParams||{},{url:D(e,n.query||{})});n.oldWebview?window.location.href=t.url:window.location.href="bdwm://native?pageName=webview&".concat(h(t))}},goLogin:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};window.WMApp.account.login(function(e){if(e.status){if(n.redirect)return window.location.href=n.redirect,null;if(n.success)return n.success(e)}return n.fail&&n.fail("CANCEL",e)})},showToast:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};window.WMApp.nui.toast({text:e.message,duration:e.duration||2})},share:Te,setShare:function(n,t){var e=n.shareText||"分享",i=n.shareIcon||"https://fuss10.elemecdn.com/0/6e/b1b68e054bc6337952d477810fe43png.png",o=n.shareEventName||"share";window.WMApp.page.setTitleBar({actionList:[{title:e,titleColor:"#ffffff",icon:i,id:o}]}),window.WMApp.entry.setPageAction("onActionClick",function(e){e&&e.result&&e.result.id===o&&(Te(n),"function"==typeof t&&t())})},popWindow:function(){window.WMApp.page.closePage()},pay:function(e){return new Promise(function(n,t){window.WMApp.pay.doPay(e,function(e){e.status?n(e):t(e)})})}});var Se=Object.create(null),_e=window.navigator.userAgent,We=!!window.__sfc__;Se.isAlipayMini=/AliApp\((AP|KB).+MiniProgram/i.test(_e),Se.isAlipayMiniApp=Se.isAlipayMini,Se.isTBMini=/AliApp\(TB/i.test(_e)&&We||/AliApp\(TB.+(Windmill|Triver)/i.test(_e),Se.isTBMiniApp=Se.isTBMini,Se.isTMMiniApp=/AliApp\(TM/i.test(_e)&&We||/AliApp\(TM.+(Windmill|Triver)/i.test(_e),Se.isAliMiniApp=We||Se.isTMMiniApp||Se.isTBMiniApp||Se.isAlipayMiniApp,Se.isAlipay=/AliApp\((AP|KB)\/([\d.]+)\)/i.test(_e)&&!Se.isAlipayMini,Se.isTaobao=/AliApp\(TB\/([\d.]+)\)/i.test(_e)&&!Se.isTBMini,Se.isEleme=/Eleme/i.test(_e),Se.isWeChat=/MicroMessenger/i.test(_e),Se.isBaiduWaiMai=/wmapp/i.test(_e),Se.isNotMain=!["isAlipay","isEleme","isTaobao"].some(function(e){return Se[e]});var Ne=Se.isAliMiniApp&&me||Se.isAlipay&&window.ap&&ue||Se.isTaobao&&window.WindVane&&K||Se.isEleme&&window.hybridAPI&&Y||Se.isWeChat&&de||Se.isAliMiniApp&&me||Se.isBaiduWaiMai&&Me||F;if(f(Se,Ne),Se.openWindow){var Oe=Se.openWindow;Se.openWindow=function(e){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=function(e,r){if(!r||!r.list||!r.list.length)return e;var n=r.userId||Number(localStorage.getItem(r.uniqueKey));if(!n&&!r.uniqueKey)return e;n||(n=(new Date).getTime(),localStorage.setItem(r.uniqueKey,n));var a=n%100,c=0,u=e;return r.list.some(function(e){var n=e.percent,t=e.url,i=e.userIdWhiteList,o=e.force;return!!(a<(c+=n)||(i||[]).some(function(e){return e===r.userId})||o)&&(u=t,!0)}),u}(e,n.gray);Oe.call(Se,t,n)}}return Se});
